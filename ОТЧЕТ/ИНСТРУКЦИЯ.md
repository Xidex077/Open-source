### Документация: как работает “Еженедельная сводка” (простыми словами)

#### 1) Что делает сводка

Сводка — это автоматически создаваемый отчет в Google Таблицах, который:

* собирает данные из листа **DATA**,
* группирует потери по разным признакам (операция, блок, МХ, этаж, ряд, сотрудник, товар),
* показывает **итоги, суммы и проценты**,
* формирует отдельный красивый лист с готовыми таблицами.

---

#### 2) Откуда берутся данные

Сводка всегда строится на основе листа **DATA**.

Для работы сводки важны такие колонки:

* **A** — *Операция / тип потери* (например: “Потери сборки”, “Потери сортировки”, “Потери СЦ”)
* **B** — *ШК* (штрих-код / идентификатор товара)
* **C** — *МХ* (место хранения/локация, где случилась потеря)
* **D** — *Блок потери* (например: зона/блок)
* **E** — *ФИО кто списал* (используется для потерь сборки)
* **F** — *ФИО раскладчика* (используется для потерь сортировки)
* **K** — *Категория товара*
* **N** — *Стоимость товара* (сумма потери)

Если какая-то из этих колонок пустая — соответствующие таблицы могут показывать “—” или 0.

---

#### 3) Как создать сводку

1. Откройте таблицу.
2. В верхнем меню появится пункт **“Создать отчет”**.
3. Нажмите **“Сформировать еженедельную сводку”**.
4. Скрипт создаст новый лист со сводкой.

---

#### 4) Как называется созданный лист

Лист создается с названием вида:

**Сводка 01.12-07.12**

Период в названии — это “последние 7 дней”, где:

* конец периода — **вчерашний день**
* начало периода — **6 дней до вчера**

Важно: период в названии — это “шапка отчета”. Если в данных нет фильтра по дате, то сводка может считать все строки, которые лежат в DATA на момент запуска.

---

#### 5) Что происходит перед построением (очистка названий операций)

Перед созданием отчета скрипт приводит колонку **A (Операция)** к единому виду:

Если в названии операции есть символ **“-”**, всё что справа от него удаляется.

Пример:
`Потери сортировки - смена 2` → станет `Потери сортировки`

Это нужно, чтобы одинаковые операции не считались разными из-за лишнего текста.

---

#### 6) Что вы увидите в готовой сводке

Сводка состоит из:

* **общего итога сверху**
* **двух больших разделов ниже**: слева сортировка (и СЦ), справа сборка

---

### 6.1. Верхний блок: “ОБЩИЕ СПИСАНИЯ КОРПУСА”

Это общая таблица по всем операциям (из колонки A).

Там показано:

* **Операция** — тип потерь (как написано в DATA!A)
* **Кол-во ШК** — сколько **уникальных** ШК попало в эту операцию
* **Сумма** — общая сумма потерь по этой операции
* **Процент** — доля этой суммы от суммы всех операций

---

### 6.2. Левая часть: “ПОТЕРИ СОРТИРОВКИ”

Этот раздел собирает информацию в основном по операциям:

* “Потери сортировки”
* (и отдельные блоки могут учитывать “Потери СЦ”, если они включены)

Тут обычно есть таблицы:

* **Потери по блокам** (из колонки D)
* **Разбивка по типам МХ** (например: Автосорт, Сорт, Предсорт, Поток и т.д.)
* **ТОП МХ** по разным категориям (показывает самые “дорогие” места потерь)
* **ТОП сотрудников** (раскладчики) по сортировке (из колонки F)

---

### 6.3. Правая часть: “ПОТЕРИ СБОРКИ”

Этот раздел строится только по операции “Потери сборки”.

Тут обычно есть таблицы:

* **ТОП этаж** — где больше всего потерь по сборке
* **ТОП ряд** — где больше всего потерь по сборке
* **ТОП МХ** — какие МХ дают больше всего потерь
* **ТОП сотрудник** — кто чаще/дороже списывает (колонка E)
* **ТОП товар** — какие категории товара чаще/дороже списываются (колонка K)

---

#### 7) Как считаются “Кол-во ШК”, “Сумма”, “Процент”

* **Кол-во ШК** — считается не количество строк, а количество **уникальных ШК**.
  То есть если один и тот же ШК встречается 10 раз, он всё равно считается как 1.

* **Сумма** — складывается из колонки **N (Стоимость товара)**.

* **Процент** — всегда показывает долю от общего итога внутри конкретной таблицы:

  * в общей таблице — от суммы всех операций
  * в таблицах сортировки — от суммы сортировки (или выбранного набора)
  * в таблицах сборки — от суммы сборки

---

#### 8) Итоги внизу каждой таблицы

Под каждой таблицей есть строка **“ИТОГО”**:

* показывает общую сумму и общее количество ШК по этой таблице,
* процент в “ИТОГО” всегда равен **100%**.

---

#### 9) Если запускать сводку несколько раз

Если сводка за этот период уже существует, она **удаляется и создается заново**.
Это сделано, чтобы отчет всегда был актуальный и без ручной правки.

---

#### 10) Какой результат получает пользователь

После запуска вы получаете:

* готовый лист-отчет,
* понятные ТОПы и итоги,
* сразу видно **где**, **кто** и **по каким товарам** потери максимальные,
* всё считается автоматически без ручных фильтров и формул.
